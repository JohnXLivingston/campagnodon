[(#AUTORISER{voir,campagnodon_campagnes}|sinon_interdire_acces)]
<BOUCLE_campagnodon_campagne(CAMPAGNODON_CAMPAGNES){id_campagnodon_campagne}>
  <h1 class="grostitre"><:campagnodon:label_campagne:> ##ID_CAMPAGNODON_CAMPAGNE</h1>
  <table>
    [
      <tr>
        <td><:campagnodon:label_titre_campagne:></td>
        <td><div class="titre">(#TITRE)</td>
      </tr>
    ]
    [
      <tr>
        <td><:campagnodon:label_texte_campagne:></td>
        <td><div class="texte">(#TEXTE)</td>
      </tr>
    ]
    [
      <tr>
        <td><:campagnodon:label_date_campagne:></td>
        <td><div class="date">(#DATE|affdate_heure)</td>
      </tr>
    ]
    [
      <tr>
        <td><:campagnodon:label_origine_campagne:></td>
        <td><div class="origine">(#ORIGINE)</td>
      </tr>
    ]
    [
      <tr>
        <td><:campagnodon:label_id_origine_campagne:></td>
        <td><div class="id_origine">(#ID_ORIGINE)</td>
      </tr>
    ]
    [
      <tr>
        <td><:campagnodon:label_statut_campagne:></td>
        <td><div class="statut">(#STATUT)</td>
      </tr>
    ]
    [(#STATUT|=={publie}|oui)<tr>
        <td><:campagnodon:label_balise:></td>
        <td id="campagnodon_balise_raffraichir">
          <form>
            <div>
              <label>
                <input type="radio" name="type" class="type" checked="checked" value="don" />
                <:campagnodon:label_type_don:>
              </label>
              <label>
                <input type="radio" name="type" class="type" value="adhesion" />
                <:campagnodon:label_type_adhesion:>
              </label>
            </div>
            <div>
              <label>
                <input type="checkbox" name="montant_perso" class="montant_libre" />
                <:campagnodon:label_montant_perso:>
              </label>
            </div>
            <div>
              <label>
                <input type="checkbox" name="montant_libre" class="montant_libre" />
                <:campagnodon:label_montant_libre:>
              </label>
            </div>
            <div>
              <label>
                <input type="checkbox" name="souscriptions_perso" class="souscriptions_perso" />
                <:campagnodon:label_souscriptions_perso:>
              </label>
            </div>
          </form>
        </td>
    </tr>]
  </table>
  <script type="text/javascript">
    jQuery(function(){
      const liste_souscriptions_perso = [(#ORIGINE|campagnodon_campagne_souscriptions_perso_json)];
      const liste_montants = [(#REM|campagnodon_campagne_montants_par_defaut)];
      $('#campagnodon_balise_raffraichir').each(function() {
        const td = jQuery(this);
        td.find('form').on('submit', function() { return false; });

        const balise = jQuery('<textarea>');
        balise.attr('style', 'width:100%');
        balise.attr('readonly', true);
        balise.on('click', function() {
          balise.select();
          if (balise.setSelectionRange) {
            balise.setSelectionRange(0, 99999) /* pour les smartphones/tablettes */
          }
        });
        td.append(balise);

        function campagnodon_balise_raffraichir() {
          let s = '<campagnodon|origine=[(#ORIGINE)]|id=[(#ID_ORIGINE)]';
          let type = td.find('input[name=type]:checked:first');
          let type_valeur = null;
          if (type.length) {
            type_valeur = type.attr('value');
            s+= '|type=' + type_valeur;
          }
          if (type_valeur === 'adhesion') {
            td.find('input[name=montant_libre]').prop('disabled', true);
          } else {
            td.find('input[name=montant_libre]').prop('disabled', false);
          }

          const montant_perso = !!td.find('input[name=montant_perso]:checked:not(:disabled)').length;
          const montant_libre = !!td.find('input[name=montant_libre]:checked:not(:disabled)').length;
          if (montant_libre || montant_perso) {
            s+= '|montants=';
            if (montant_perso) {
              s+= liste_montants[type_valeur] ? liste_montants[type_valeur] : '10,20,40';
              if (montant_libre) {
                s+= ',libre';
              }
            } else if (montant_libre) {
              s+= 'libre';
            }
          }

          const souscriptions_perso = !!td.find('input[name=souscriptions_perso]:checked:not(:disabled)').length;
          if (souscriptions_perso) {
            s+= '|souscriptions=';
            liste_so = liste_souscriptions_perso[type_valeur] ?? [];
            s+= liste_so.join(',');
          }

          s+= '>';
          balise.text(s);
        }
        campagnodon_balise_raffraichir();
        td.on('click', 'input[type=radio], input[type=checkbox]', campagnodon_balise_raffraichir);
      });
    });
  </script>
</BOUCLE_campagnodon_campagne>
