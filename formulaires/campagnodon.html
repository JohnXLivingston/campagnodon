<div class="formulaire_spip formulaire_#FORM">
  [<p class="reponse_formulaire reponse_formulaire_ok">(#ENV*{message_ok})</p>]
  [<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]

  <BOUCLE_editable(CONDITION){si #ENV{editable}}>
    <form name="formulaire_#FORM" action="#ENV{action}" method="post" campagnodon_type="#ENV{_type}">
      #ACTION_FORMULAIRE{#ENV{action}}

      [(#REM) Si on est sur un formulaire d'adhésion, on affiche le bloc correspondant, ainsi qu'une checkbock pour ajouter un don :]
      <BOUCLE_adhesion(CONDITION){si #ENV{_type}|=={adhesion}}>
        <fieldset>
          <legend><span><:campagnodon_form:j_adhere:></span></legend>
          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{montant_adhesion}})]
              <div class="editer editer_montant_adhesion obligatoire [(#GET{erreurs}|oui)erreur]">
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <div class="campagnodon_montant_adhesion">

                  [(#REM) Et on boucle sur les propositions.]
                  <BOUCLE_montants_adhesion(POUR){tableau #ENV{_montants_propositions_adhesion}}>
                    #SET{val,#CLE}
                    <label>
                      <input type="radio" name="montant_adhesion" class="radio" required="required" id="montant_adhesion_#GET{val}" value="#GET{val}" [(#ENV{montant_adhesion}|=={#GET{val}}|oui)checked="checked"] />
                      <span>#VALEUR</span>
                    </label>
                  </BOUCLE_montants_adhesion>
                </div>
              </div>
            </div>
          </div>
          [(#REM) Le paragraphe «adhesion_explication» est rempli via JS.]
          <p class="explication" display="none"
            [(#ENV{_adhesion_magazine}|oui)
              adhesion_magazine_prix="#ENV{_adhesion_magazine_prix}"
              adhesion_explication="<:campagnodon_form:adhesion_magazine_explication:>"
            ]
            [(#ENV{_adhesion_magazine}|non)
              adhesion_explication="<:campagnodon_form:adhesion_explication:>">
            ]
          >
          </p>
        </fieldset>

        <div class="row-fluid">
          <div class="form-group span12 choix">
            [(#SET{erreurs, #ENV**{erreurs}|table_valeur{adhesion_avec_don}})]
            <div class="editer editer_adhesion_avec_don [(#GET{erreurs}|oui)erreur]">
              <input
                type="checkbox"
                name="adhesion_avec_don"
                class="checkbox"
                value="1"
                id="champ_adhesion_avec_don"
                [(#ENV{adhesion_avec_don}|=={1}|oui)checked="checked"]
              />
              <label for="champ_adhesion_avec_don"><:campagnodon_form:label_adhesion_avec_don:></label>
              [<span class='erreur_message'>(#GET{erreurs})</span>]
            </div>
          </div>
        </div>
      </BOUCLE_adhesion>

      [(#REM) Ci dessous le bloc des dons. Toujours affiché (mais son apparence change légèrement)]
      <fieldset si_adhesion_avec_don>
        [(#ENV{_type}|=={adhesion}|non)
          <legend><span><:campagnodon_form:je_donne:></span></legend>
        ]

        <div class="row-fluid">
          <div class="form-group span12">
            [(#SET{erreurs, #ENV**{erreurs}|table_valeur{montant}})]
            <div class="editer editer_montant obligatoire [(#GET{erreurs}|oui)erreur]">
              [<span class='erreur_message'>(#GET{erreurs})</span>]
              <div class="campagnodon_montant">

                [(#REM) Sauf si on ne met que des montants de don libre, on affiche la liste des montants présélectionnés.]
                <BOUCLE_liste_montants(CONDITION){si #ENV{_montants_propositions_uniquement_libre}|non}>
                  <div class="campagnodon_montant_ligne">
                    <BOUCLE_montants(POUR){tableau #ENV{_montants_propositions}}>
                      #SET{val,#CLE}
                      <label>
                        <input type="radio" name="montant" class="radio" required="required" id="montant_#GET{val}" value="#GET{val}" [(#ENV{montant}|=={#GET{val}}|oui)checked="checked"] />
                        <span>#VALEUR</span>
                      </label>
                    </BOUCLE_montants>
                  </div>
                </BOUCLE_liste_montants>

                [(#REM) On affiche la saisie de montant libre si activée.]
                [(#ENV{_montants_proposition_libre}|oui)
                  [(#SET{erreurs, #ENV**{erreurs}|table_valeur{montant_libre}})]
                  [<span class='erreur_message'>(#GET{erreurs})</span>]
                  <div class="campagnodon_montant_ligne">

                    [(#REM) Si on n'a que le montant libre, le champs 'montant' est caché, sinon c'est un bouton radio.]
                    [(#ENV{_montants_propositions_uniquement_libre}|oui)
                      <input type="hidden" name="montant" value="libre" />
                    ]
                    [(#ENV{_montants_propositions_uniquement_libre}|non)
                      #SET{val,libre}
                      <label>
                        <input type="radio" name="montant" class="radio" required="required" id="montant_#GET{val}" value="#GET{val}" [(#ENV{montant}|=={#GET{val}}|oui)checked="checked"] />
                        <span><:campagnodon_form:montant_libre:></span>
                      </label>
                    ]
                    <label>
                      <input
                        type="number" name="montant_libre"
                        class="text" value="#ENV*{montant_libre}"
                        id="champ_montant_libre"
                        [(#ENV{_montants_propositions_uniquement_libre}|non)disabled="disabled"]
                      />&nbsp;€
                    </label>
                  </div>
                ]
              </div>
            </div>
          </div>
        </div>
        [(#REM) Le paragraphe «recu_fiscal_explication« est rempli via JS. Sa position dépend du type de formulaire.]
        [(#ENV{_type}|=={adhesion}|oui)
          <p class="explication" display="none" recu_fiscal_explication="<:campagnodon_form:recu_fiscal_explication:>">
          </p>
        ]
      </fieldset>

      [(#REM) Les coordonnées personnelles:]
      <fieldset>
        <legend><span><:campagnodon_form:coordonnees:></span></legend>

        <div class="row-fluid">
          <div class="form-group span12">
            [(#SET{erreurs, #ENV**{erreurs}|table_valeur{email}})]
            <div class="editer editer_email obligatoire [(#GET{erreurs}|oui)erreur]">
              <label for="champ_email"><:campagnodon_form:label_email:></label>
              [<span class='erreur_message'>(#GET{erreurs})</span>]
              <input type="email" name="email" class="text" value="#ENV*{email}" id="champ_email" required="required"/>
            </div>
          </div>
        </div>

        [(#REM) sur le formulaire d'adhésion, recu_fiscal est implicite.]
        [(#ENV{_type}|=={adhesion}|non)
          <div class="row-fluid">
            <div class="form-group span12 choix">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{recu_fiscal}})]
              <div class="editer editer_recu_fiscal [(#GET{erreurs}|oui)erreur]">
                <input
                  type="checkbox"
                  name="recu_fiscal"
                  class="checkbox"
                  value="1"
                  id="champ_recu_fiscal"
                  [(#ENV{recu_fiscal}|=={1}|oui)checked="checked"]
                />
                <label for="champ_recu_fiscal"><:campagnodon_form:label_recu_fiscal:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
              </div>
            </div>
          </div>
        ]

        <div si_recu_fiscal="">
          [(#REM) Le paragraphe «recu_fiscal_explication« est rempli via JS. Sa position dépend du type de formulaire.]
          [(#ENV{_type}|=={adhesion}|non)
            <p class="explication" display="none" recu_fiscal_explication="<:campagnodon_form:recu_fiscal_explication:>">
            </p>
          ]

          <p class="explication">
            <:campagnodon_form:recu_fiscal_champs_supplementaires:>
          </p>

          <div class="row-fluid">
            <div class="form-group span2">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{civilite}})]
              <div class="editer editer_civilite [(#GET{erreurs}|oui)erreur]">
                <label for="champ_civilite"><:campagnodon_form:label_civilite:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <select name="civilite" class="select" id="champ_civilite">
                  <option value=""></option>
                  <BOUCLE_civilites(POUR){tableau #ENV{_civilites}}>
                    #SET{val,#CLE}
                    <option value="#GET{val}" [(#ENV{civilite}|=={#GET{val}}|oui)selected="selected"]>#VALEUR</option>
                  </BOUCLE_civilites>
                </select>
              </div>
            </div>
            <div class="form-group span5">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{prenom}})]
              <div class="editer editer_prenom obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_prenom"><:campagnodon_form:label_prenom:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" name="prenom" class="text" value="#ENV*{prenom}" id="champ_prenom" required="required" />
              </div>
            </div>
            <div class="form-group span5">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{nom}})]
              <div class="editer editer_nom obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_nom">Nom de famille</label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" name="nom" class="text" value="#ENV*{nom}" id="champ_nom" required="required" />
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{date_naissance}})]
              <div class="editer editer_date_naissance [(#GET{erreurs}|oui)erreur]">
                <label for="champ_date_naissance"><:campagnodon_form:label_date_naissance:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="date" name="date_naissance" class="date" value="#ENV*{date_naissance}" id="champ_date_naissance" />
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{adresse}})]
              <div class="editer editer_adresse obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_adresse"><:campagnodon_form:label_adresse:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" name="adresse" class="text" value="#ENV*{adresse}" id="champ_adresse" required="required" />
              </div>
            </div>
          </div>
          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{complement_adresse_1}})]
              <div class="editer editer_complement_adresse_1 [(#GET{erreurs}|oui)erreur]">
                <label for="champ_complement_adresse_1"><:campagnodon_form:label_complement_adresse_1:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" name="complement_adresse_1" class="text" value="#ENV*{complement_adresse_1}" id="champ_complement_adresse_1" />
              </div>
            </div>
          </div>
          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{complement_adresse_2}})]
              <div class="editer editer_complement_adresse_2 [(#GET{erreurs}|oui)erreur]">
                <label for="champ_complement_adresse_2"><:campagnodon_form:label_complement_adresse_2:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" name="complement_adresse_2" class="text" value="#ENV*{complement_adresse_2}" id="champ_complement_adresse_2" />
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <div class="form-group span2">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{code_postal}})]
              <div class="editer editer_code_postal obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_code_postal"><:campagnodon_form:label_code_postal:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text"  name="code_postal" class="text" value="#ENV*{code_postal}" id="champ_code_postal" required="required" />
              </div>
            </div>
            <div class="form-group span6">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{ville}})]
              <div class="editer editer_ville obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_ville"><:campagnodon_form:label_ville:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="text" required="required"  name="ville" class="text" value="#ENV*{ville}" id="champ_ville"/>
              </div>
            </div>
            <div class="form-group span4">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{pays}})]
              <div class="editer editer_pays obligatoire [(#GET{erreurs}|oui)erreur]">
                <label for="champ_pays"><:campagnodon_form:label_pays:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <select required="required" name="pays" class="select" id="champ_pays">
                  <option value=""></option>
                  <BOUCLE_p(pays){par nom}>
                    <option value="#CODE" [(#ENV*{pays}|=={#CODE}|oui) selected="selected"]>#NOM</option>
                  </BOUCLE_p>
                </select>
              </div>
            </div>
          </div>

          <div class="row-fluid">
            <div class="form-group span12">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{telephone}})]
              <div class="editer editer_telephone [(#GET{erreurs}|oui)erreur]">
                <label for="champ_telephone"><:campagnodon_form:label_telephone:></label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
                <input type="tel" name="telephone" class="tel" value="#ENV*{telephone}" id="champ_telephone"/>
              </div>
            </div>
          </div>

        </div>

        <BOUCLE_souscriptions_optionnelles(POUR){tableau #ENV{_souscriptions_optionnelles}}>
          #SET{nom_champ,souscription_optionnelle_#CLE}
          #SET{label_champ, #VALEUR|table_valeur{label}}
          <div class="row-fluid">
            <div class="form-group span12 choix">
              [(#SET{erreurs, #ENV**{erreurs}|table_valeur{#GET{nom_champ}}})]
              <div class="editer editer_#GET{nom_champ} [(#GET{erreurs}|oui)erreur]">
                <input
                  type="checkbox"
                  name="#GET{nom_champ}"
                  class="checkbox"
                  value="1"
                  id="champ_#GET{nom_champ}"
                  [(#ENV{#GET{nom_champ}}|=={1}|oui)checked="checked"]
                />
                <label for="champ_#GET{nom_champ}">#GET{label_champ}</label>
                [<span class='erreur_message'>(#GET{erreurs})</span>]
              </div>
            </div>
          </div>
        </BOUCLE_souscriptions_optionnelles>
      </fieldset>

      <p class="explication">
        *: <:campagnodon_form:champ_obligatoire:>
      </p>

      <p class="boutons">
        <input type="submit" class="submit" value="<:campagnodon_form:valider:>" />
      </p>
    </form>
  </BOUCLE_editable>
</div>
<script type="text/javascript">
  (function ($) {
    campagnodon_formulaire('.formulaire_#FORM');
  })(window.jQuery);
</script>
