[{"uri":"https://johnxlivingston.github.io/campagnodon/","title":"Campagnodon","tags":[],"description":"","content":"Campagnodon Plugin SPIP pour la gestion des campagnes d\u0026rsquo;adhésions et de dons.\nPrésentation Systèmes distants Limitations connues "},{"uri":"https://johnxlivingston.github.io/campagnodon/presentation/","title":"Présentation","tags":[],"description":"","content":"Campagnodon est un Plugin SPIP pour la gestion des campagnes d\u0026rsquo;adhésions et de dons.\nCe plugin s\u0026rsquo;interface avec le plugin Bank, et propose des formulaires d\u0026rsquo;adhésions et de dons.\nCe plugin a été développé pour les besoins d\u0026rsquo;Attac France, en remplacement du plugin souscription.\nContrairement au plugin souscription, le stockage et le traitement des données personnelles se fait dans un système distant, pour des raisons de compartimentation et de sécurisation. Dans le cas d\u0026rsquo;Attac France, ces données sont stockées et traitées via une instance CiviCRM (non accessible publiquement).\nPour l\u0026rsquo;instant, le code est conçu pour répondre aux besoins d\u0026rsquo;Attac France, et est notamment lié à CiviCRM (voir la documentation). Toutefois, le code essaie d\u0026rsquo;être le plus générique possible, et fait en sorte d\u0026rsquo;être face à étendre.\nPour la liste des versions disponibles, merci de vous référer au fichier CHANGELOG.md présent dans le dépot.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/presentation/fonctionnel/","title":"Fonctionnel","tags":[],"description":"","content":"Formulaires de dons et adhésion Le plugin SPIP Campagnodon permet d\u0026rsquo;inclure dans des articles SPIP des formulaires de dons ou d\u0026rsquo;adhésions:\nCes formulaires sont hautement configurables, aussi bien au niveau de l\u0026rsquo;installation complète, que article par article:\nchoix des montants proposés proposer les dons mensuels ou non proposer la saisie d\u0026rsquo;un don à montant libre on peut configurer et ajouter autant d\u0026rsquo;options «opt-in» que l\u0026rsquo;on veut Attention, Campagnodon ne gère pas la partie bancaire. Il vous faut utiliser le plugin SPIP Bank, et le configurer pour faire appel à un prestataire bancaire.\nSystème distant Les données personnelles ne sont pas stockées coté SPIP, elles sont envoyées dans un système distant, qui peut ne pas être accessible publiquement.\nCela permet de compartimenter et sécuriser les données.\nÀ l\u0026rsquo;origine, ce projet a été conçu avec une extension CiviCRM Campagnodon CiviCRM. Mais les API de communication entre ces deux systèmes sont standardisées, et il est possible de mettre d\u0026rsquo;autres systèmes en lieu et place de CiviCRM (à condition de développer les connecteurs adéquates).\nSi vous souhaitez utiliser Campagnodon avec autre chose que CiviCRM (ou même autre chose que SPIP), n\u0026rsquo;hésitez pas à contacter John Livingston. Vous pouvez par exemple passer par les gestionnaires de tickets de l\u0026rsquo;un des dépots de code référencé sur ce site web (voir dans le menu gauche).\nCiviCRM Coté CiviCRM, l\u0026rsquo;extension Campagnodon CiviCRM vient avec une application permettant de suivre les «transactions Campagnodon». Elle fourni également des API dédiées, qui permettent de:\ncréer des contributions créer ou prolonger des adhésions dédoublonner automatiquement les contacts gérer les options présentes dans le formulaire (par ex: accepter d\u0026rsquo;être démarché, être ajouté à des groupes, etc\u0026hellip;) On peut alors retrouver dans CiviCRM l\u0026rsquo;historique complet des données venant de Campagnodon.\nEt pour chaque transaction, son détail:\nle contact les données personnelles saisies les contributions crées les adhésions crées les groupes dans lesquels le contact a été ajouté \u0026hellip; "},{"uri":"https://johnxlivingston.github.io/campagnodon/distant/","title":"Systèmes distants","tags":[],"description":"","content":"Systèmes distants Campagnodon s\u0026rsquo;interface avec un (ou plusieurs) système(s) distant(s).\nCampagnodon est conçu de sorte à permettre de facilement changer le système distant dans lequel les données personnelles vont être stockées.\nLes données personnelles ne seront pas stockées sur le système d\u0026rsquo;origine (SPIP).\nÀ la date de rédaction de la présente page, Attac France se sert de Campagnodon avec CiviCRM en backend.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/presentation/architecture/","title":"Architecture","tags":[],"description":"","content":"Principes de base Campagnodon est conçu de sorte à séparer:\nLe système d\u0026rsquo;origine: il s\u0026rsquo;agit du site public sur lequel les utilisateur⋅rice⋅s pourront effectuer des dons et adhésions Le système distant: il s\u0026rsquo;agit du backend dans lequel seront traités les données personnelles graph LR; Origine[Système d'origine] Distant[Système distant] Origine --\u003e Distant Distant -.-\u003e Origine À noter que les API utilisées pour communiquer entre les deux systèmes sont (quasiment) unidirectionnelles: en dehors d\u0026rsquo;un cas particulier (décrit plus loin), le système d\u0026rsquo;origine ne peut qu\u0026rsquo;alimenter le système distant, mais ne peut en extraire de donnée. Cela permet de compartimenter les données, et permet une meilleure sécurisation de celles-ci.\nCampagnodon a été originellement conçu pour:\nSPIP comme système d\u0026rsquo;origine CiviCRM comme système distant Toutefois, les API utilisées pour la communication sont standardisées, et il est tout à fait possible de changer le système d\u0026rsquo;origine et/ou le système distant.\nUn même système d\u0026rsquo;origine peut pointer vers plusieurs systèmes distants. Il n\u0026rsquo;y a pas forcément de cas d\u0026rsquo;usage précis pour cela, mais cela permet de simplifier un éventuel changement de système distant.\nFlux Dans le schéma ci-dessous, nous utiliserons SPIP comme système d\u0026rsquo;origine et CiviCRM comme système distant pour mieux illustrer.\nsequenceDiagram participant SPIP participant CiviCRM Note over SPIP: L'utilisateur⋅rice soumet le formulaire de don/adhésion SPIP -\u003e\u003e CiviCRM: Création d'une transaction Note over SPIP: Choix de la méthode de paiement SPIP --\u003e\u003e CiviCRM: Dans certains cas, le prestaire a besoin des données personnelles (DSP2) CiviCRM --\u003e\u003e SPIP: Renvoi des données personnelles, uniquement si la transaction est bien en cours Note over SPIP: Validation de la méthode de paiement loop Statut de la transaction mis à jour par SPIP Bank/le pretataire bancaire SPIP -\u003e\u003e CiviCRM: Mise à jour du statut de la transaction end En dehors du cas où le prestataire bancaire a besoin de données personnelles pour gérer le protocole DSP2 (voir la documentation de SPIP Bank), les API fonctionnent donc de manière uni-directionnelles: SPIP alimente CiviCRM, mais ne peut pas en extraire de donnée personnelle.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/presentation/licence/","title":"Licence","tags":[],"description":"","content":"Ce projet est sous licence AGPLv3 licence.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/limitations/","title":"Limitations connues","tags":[],"description":"","content":"SPIP Dépendances obsolètes Pour faciliter le développement de Campagnodon pour Attac France, nous avons figé certaines dépendances de plugins dans des versions obsolètes.\nDe plus, les squelettes ont été conçu pour bootstrap2 (qui est la version utilisée par Attac France).\nSi ces dépendances vous posent problèmes, ou si vous souhaitez utiliser une version plus récente de boostrap, n\u0026rsquo;hésitez pas à contacter l\u0026rsquo;auteur, par exemple via l\u0026rsquo;un des dépots listé dans le menu gauche.\nCiviCRM Droits d\u0026rsquo;accès et extensions tierces Les appels d\u0026rsquo;API effectués par Campagnodon sont fait avec des droits restreints. Si d\u0026rsquo;autres extensions CiviCRM utilisent des Hooks pour ajouter des actions spécifiques, il se peut que ces actions fassent échouer les appels d\u0026rsquo;API (ou est un comportement innatendu), à cause de droits manquants.\nPar exemple, si une extension essaie d\u0026rsquo;intercepter les changements d\u0026rsquo;adresse sur des contacts, pour par exemple ajouter des «relationship», cela risque d\u0026rsquo;échouer.\nActuellement la seule solution proposée est de modifier les extensions en question pour prendre en compte ce cas de figure. Par exemple en y désactivant le «check permission» des appels d\u0026rsquo;API CiviCRM v3 et v4.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://johnxlivingston.github.io/campagnodon/distant/civicrm/","title":"CiviCRM","tags":[],"description":"","content":"Le présent document indique comment installer un environnement de développement/test conforme à ce qu\u0026rsquo;utilise Attac.\nInstallation de CiviCRM CiviCRM\nbuildkit CiviCRM fourni l\u0026rsquo;outils buildkit qui met à disposition un ensemble d\u0026rsquo;outils pour faciliter le déploiement d\u0026rsquo;instances CiviCRM sur une machine de développement.\nLa première étape est donc d\u0026rsquo;installer buildkit sur la machine de développement (ou dans une machine virtuelle).\nPour cela, suivre la documentation d\u0026rsquo;installation de buildkit.\nDéployer une instance CiviCRM CiviCRM doit être associé à un CRM. Chez Attac, il s\u0026rsquo;agit de Drupal 7. À l\u0026rsquo;heure où cette documentation est écrite, CiviCRM est dans la version 5.47.\nOn peut aisément utiliser l\u0026rsquo;utilitaire civibuild pour créer une instance CiviCRM vierge. Pour cela, se placer dans le dossier où l\u0026rsquo;on a intallé buildkit, puis:\n./bin/civibuild create dev_attac --type drupal-clean --url http://127.0.0.1:9900 --civi-ver 5.47 Dans la ligne ci-dessus, on choisi d\u0026rsquo;installer CiviCRM sur localhost, et le rendre accessible via le port 9900. Adaptez ceci à votre situation.\nLes identifiants pour s\u0026rsquo;y connecter seront affiché dans la console.\nNote: ce type d\u0026rsquo;installation vient avec des données d\u0026rsquo;exemple.\nConfigurations spécifiques de CiviCRM Le mode de fonctionnement pour Attac suppose les configurations ci-dessous.\nActiver le composant «civicampaign» (Administrer \u0026gt; Paramètres système \u0026gt; Composants). Il faut activer l\u0026rsquo;extension php-curl sur le serveur qui fait tourner le système d\u0026rsquo;origine (SPIP). Il est possible d\u0026rsquo;utiliser le composant «CiviRules» pour envoyer des mails. Installer l\u0026rsquo;extension CiviCRM Campagnodon Allant de paire avec Campagnodon, il y a une Extension CiviCRM campagnodon-civicrm.\nPlacer les fichiers de l\u0026rsquo;extension dans le dossier des extensions du CiviCRM, puis aller dans l\u0026rsquo;interface d\u0026rsquo;administration Administrer \u0026gt; Paramètres système \u0026gt; Extension pour l\u0026rsquo;activer.\nIl faut ensuite obtenir des clés d\u0026rsquo;API CiviCRM, et les configurer coté SPIP. Pour obtenir les clés, on pourra par exemple installer l\u0026rsquo;extension API Key Management. Ensuite, aller sur la fiche contact de l\u0026rsquo;utilisateur admin qui servira (ce sont ses droits qui seront appliqués), ouvrir l\u0026rsquo;onglet «API Key», générer une nouvelle clé d\u0026rsquo;API. La clé de site, aussi nécessaire, est affichée sur le même écran.\n"},{"uri":"https://johnxlivingston.github.io/campagnodon/tags/","title":"Tags","tags":[],"description":"","content":""}]